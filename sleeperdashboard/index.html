<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sleeper Discounts Dashboard</title>
    <style>
        #table-container {
            margin-top: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        #filter-container {
            margin-bottom: 10px;
        }
        label, select, input {
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <h1>Sleeper Discounts Dashboard</h1>

    <div id="table-container">
        <h2>Data Table</h2>
        <div id="filter-container">
            <label for="filter-column">Filter by Column:</label>
            <select id="filter-column">
                <!-- Options will be populated dynamically -->
            </select>
            <input type="text" id="filter-value" placeholder="Filter value">
            <button onclick="applyFilter()">Apply Filter</button>
        </div>
        <table id="data-table">
            <thead>
                <tr>
                    <!-- Headers will be populated dynamically -->
                </tr>
            </thead>
            <tbody>
                <!-- Rows will be populated dynamically -->
            </tbody>
        </table>
    </div>

    <script>
        const csvUrl = 'https://raw.githubusercontent.com/potternate/potternate.github.io/main/sleeperdashboard/newsleeperdiscounts.csv';

        let fullData = []; // To store the full dataset
        let headers = []; // To store headers separately

        fetch(csvUrl)
            .then(response => response.text())
            .then(data => {
                const rows = data.split('\n').filter(row => row.trim() !== ''); // Remove empty rows
                headers = rows[0].split(','); // Get column headers
                fullData = rows.slice(1).map(row => row.split(',')); // Get data rows

                populateTable(fullData, headers);
                populateFilterOptions(headers);
            })
            .catch(error => console.error('Error loading or parsing CSV:', error));

        function populateTable(data, headers) {
            const table = document.getElementById('data-table');
            const thead = table.querySelector('thead tr');
            const tbody = table.querySelector('tbody');

            // Populate headers
            thead.innerHTML = headers.map(header => `<th>${header}</th>`).join('');

            // Populate rows
            tbody.innerHTML = data.map(row => `<tr>${row.map(cell => `<td>${cell}</td>`).join('')}</tr>`).join('');
        }

        function populateFilterOptions(headers) {
            const filterColumn = document.getElementById('filter-column');
            filterColumn.innerHTML = headers.map(header => `<option value="${header}">${header}</option>`).join('');
        }

        function applyFilter() {
            const filterColumn = document.getElementById('filter-column').value;
            const filterValue = document.getElementById('filter-value').value.toLowerCase();

            const columnIndex = headers.indexOf(filterColumn);

            if (columnIndex === -1) return; // Exit if column is not found

            const filteredData = fullData.filter(row => {
                return row[columnIndex].toLowerCase().includes(filterValue);
            });

            populateTable(filteredData, headers);
        }
    </script>
</body>
</html>
